<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Documentation - ONDEMANDENV.dev</title>
    <link rel="stylesheet" href="styles.css">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HLWV6BZQE1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }

        gtag('js', new Date());
        gtag('config', 'G-HLWV6BZQE1');
    </script>
    <!-- Basic styling for documentation page -->
    <style>
        /* Main layout */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .docs-container {
            display: flex;
            flex-grow: 1;
        }

        /* Sidebar (Table of Contents) */
        .docs-sidebar {
            width: 260px; /* Fixed width for the sidebar */
            flex-shrink: 0; /* Prevent sidebar from shrinking */
            height: calc(100vh - 60px); /* Adjust 60px based on actual header height */
            position: sticky;
            top: 60px; /* Adjust based on actual header height */
            overflow-y: auto; /* Allow scrolling within sidebar */
            padding: 2rem 1rem 2rem 0; /* Add padding */
            border-right: 1px solid var(--border-color);
            background-color: #fdfdfd; /* Slightly off-white background */
        }

        .docs-sidebar h2 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            padding-left: 1rem; /* Indent heading */
        }

        .docs-sidebar ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .docs-sidebar ul ul { /* Nested lists for sub-sections */
           padding-left: 1.5rem; /* Indent sub-items */
           margin-top: 0.25rem;
           margin-bottom: 0.5rem;
        }

        .docs-sidebar li {
            margin-bottom: 0.25rem;
        }

        .docs-sidebar a {
            display: block;
            text-decoration: none;
            color: var(--secondary-color);
            padding: 0.4rem 1rem; /* Padding for clickable area */
            border-radius: 4px;
            font-size: 0.9rem;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        .docs-sidebar a:hover {
            background-color: #f0f0f0;
            color: var(--primary-color);
        }

        /* Consider adding an 'active' state later with JS if needed */

        /* Main Content Area */
        .docs-content-area {
            flex-grow: 1; /* Allow content to take remaining space */
            padding: 2rem 3rem; /* Add padding around content */
            max-width: 900px; /* Optional: Limit content width for readability */
            margin-left: auto; /* Center the content area if max-width is set */
            margin-right: auto; /* Center the content area if max-width is set */
        }

        /* Doc Section Styling (minor adjustments might be needed) */
        .doc-section {
             margin-bottom: 3rem;
             padding-bottom: 1.5rem;
             border-bottom: 1px solid var(--border-color);
             scroll-margin-top: 70px; /* Adjust offset for sticky header */
         }

        .doc-section:last-child {
            border-bottom: none;
        }

        /* Remove border from last section */

        .doc-section h1 {
            font-size: 2.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }

        /* Specific H1 style for content */
        .doc-section h2 {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            padding-top: 1rem;
            border-top: 1px dashed var(--border-color);
        }

        /* Add top border to separate sections visually */
        .doc-section h2:first-of-type {
            border-top: none;
            padding-top: 0;
        }

        /* No top border for the very first H2 */

        .doc-section h3 {
            font-size: 1.5rem;
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--secondary-color);
        }

        .doc-section h4 {
            font-size: 1.1rem;
            margin-top: 1.25rem;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .doc-section p {
            margin-bottom: 1rem;
            line-height: 1.7;
        }

        .doc-section ul {
            list-style: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .doc-section ol {
            list-style: decimal;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .doc-section li {
            margin-bottom: 0.5rem;
        }

        .doc-section pre {
            background-color: #f8f9fa;
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
            margin-bottom: 1rem;
            font-size: 0.9em;
        }

        .doc-section code {
            font-family: monospace;
            font-size: 0.9em;
        }

        .doc-section pre code {
            background-color: transparent;
            padding: 0;
        }

        .doc-section strong {
            font-weight: bold;
        }

        .doc-section .inline-code {
            background-color: #f0f0f0;
            padding: 0.1em 0.4em;
            border-radius: 3px;
            font-family: monospace;
            font-size: 0.9em;
            color: #343a40;
        }

        .setup-architecture {
            margin: 2rem auto;
            text-align: center;
            max-width: 100%; /* Let it fill content area width */
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .setup-image {
            max-width: 100%;
            height: auto;
            border: 1px solid var(--border-color);
        }

        .setup-caption {
            padding-top: 1rem;
            font-size: 0.9rem;
            color: #555;
        }

        .repo-link {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 0.5rem 1rem;
            text-decoration: none;
            border-radius: 5px;
            margin-top: 0.5rem;
        }

        .repo-link:hover {
            background-color: var(--secondary-color);
        }

        /* Footer adjustment */
        footer {
            width: 100%;
            text-align: center;
            padding: 1rem 0;
            margin-top: auto;
            background-color: #f8f9fa;
            border-top: 1px solid var(--border-color);
        }

        /* Responsive: Hide sidebar on smaller screens (example) */
        @media (max-width: 768px) {
            .docs-container {
                flex-direction: column;
            }

            .docs-sidebar {
                width: 100%;
                height: auto; /* Allow height to adjust */
                position: static; /* Remove sticky positioning */
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding: 1rem;
                overflow-y: visible;
            }

            .docs-content-area {
                padding: 1.5rem; /* Reduce padding */
                 margin-left: 0;
                 margin-right: 0;
                 max-width: none; /* Allow full width */
            }

            .doc-section {
                scroll-margin-top: 60px;
            }

            /* Adjust scroll margin if header is still fixed */
        }

    </style>
</head>
<body>
<header>
    <nav>
        <div class="logo">ONDEMANDENV.dev</div>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="concepts.html">Core Concepts</a></li>
            <li><a href="patterns.html">Patterns & Use Cases</a></li>
            <li><a href="documentation.html">Documentation</a></li>
            <li><a href="articles.html">Articles</a></li>
            <li><a href="https://github.com/ondemandenv" target="_blank">GitHub Org</a></li>
            <li><a href="mailto:contacts@ondemandenv.dev">Request Demo</a></li>
        </ul>
        <div class="language-switcher">
            <select onchange="window.location.href=this.value;">
                <option value="documentation.html" selected>English</option>
                <option value="ja/documentation.html">日本語</option>
                <option value="zh-TW/documentation.html">繁體中文</option>
            </select>
        </div>
    </nav>
</header>

<div class="docs-container">

    <aside class="docs-sidebar" aria-labelledby="toc-heading">
        <h2 id="toc-heading">Table of Contents</h2>
        <ul>
            <li><a href="#setup">Installation & Setup</a>
                <ul>
                    <li><a href="#prerequisites">Prerequisites</a></li>
                    <li><a href="#account-structure">AWS Account Structure</a></li>
                    <li><a href="#bootstrapping">Bootstrapping Trust & CDK</a></li>
                    <li><a href="#github-setup">GitHub Setup</a></li>
                    <li><a href="#platform-deployment">Deploying the Platform</a></li>
                </ul>
            </li>
            <li><a href="#core-workflow">Core Workflow & How-To</a>
                <ul>
                    <li><a href="#define-in-contractslib">1. Define in `contractsLib`</a></li>
                    <li><a href="#implement-service">2. Implement Service</a></li>
                    <li><a href="#deploy-iterate">3. Deploy & Iterate</a></li>
                    <li><a href="#clone-enver">4. Clone Enver</a></li>
                    <li><a href="#delete-clone">5. Delete Clone</a></li>
                    <li><a href="#dynamic-cloning">Dynamic/Ephemeral Cloning</a></li>
                    <li><a href="#use-platform-services">Use Platform Services</a></li>
                </ul>
            </li>
            <li><a href="#deployment-model">Deployment Model</a></li>
            <li><a href="#security">Security Considerations</a></li>
            <li><a href="#cicd">CI/CD Integration</a></li>
            <li><a href="#base-library">Base Library</a></li>
            <li><a href="#explore-code">Explore the Code</a></li>
            <li><a href="#platform-internals">Platform Internals</a></li>
            <li><a href="#workflow-clone">Cloning Workflow</a></li>
            <li><a href="#workflow-cleanup">Cleanup</a></li>
        </ul>
        <li><a href="#console">ONDEMANDENV Console</a>
            <ul>
                <li><a href="#console-overview">Overview</a></li>
                <li><a href="#console-auth-setup">Console Authentication Setup</a></li>
                <li><a href="#console-features">Key Features</a></li>
                <li><a href="#console-example">Example Access</a></li>
            </ul>
        </li>
        <li><a href="#contributing">Contributing</a></li>
        <li><a href="#support">Support</a></li>
        </ul>
    </aside>

    <main class="docs-content-area">
        <section class="doc-section" id="top"> <!-- Added id=top for potential skip link -->
             <h1>Documentation & Getting Started</h1>
            <p>This documentation guides you through setting up and using ONDEMANDENV to implement the core <strong>anti-stagnation patterns</strong> that enable your teams to break free from integration complexity and accelerate innovation. By following these steps, you will get the platform operational and learn how to integrate your services into an ecosystem built for velocity.</p>
         </section>

        <section class="doc-section" id="setup">
            <h2>Installation & Setup</h2>
            <p>Follow these steps to set up the ONDEMANDENV platform in your environment.</p>

            <h3 id="prerequisites">1. Environment Preparation</h3>

            <h4>AWS Environment:</h4>
            <ul>
                <li>
                    <strong>AWS Organization:</strong> Set up an <a href="https://aws.amazon.com/organizations/"
                                                                    target="_blank" rel="noopener noreferrer">AWS
                    Organization</a>.
                </li>
                <li>
                    <strong>Two AWS Accounts:</strong> Within your organization, designate or create:
                    <ul>
                        <li>A <strong>Central Account</strong>: This is where the core ONDEMANDENV platform engine will
                            run.
                        </li>
                        <li>A <strong>Workspace Account (<span class="inline-code">workspace0</span>)</strong>: The
                            initial target for deployments, including the mandatory <span class="inline-code">contractsLib</span>
                            enver.
                        </li>
                    </ul>
                </li>
                <li>
                    <strong>Hosted Zone:</strong> Create a public hosted zone in Route 53 within the <strong>Central
                    Account</strong>. Choose a suitable domain name, for example: <span class="inline-code">&lt;your-chosen-name&gt;.root.ondemandenv.link</span>.
                    Note this name, as you will need it later.
                </li>
                <li>
                    <strong>Region:</strong> Decide on the primary AWS region (e.g., <span
                        class="inline-code">us-east-1</span>). All initial setup resources should be in this region.
                </li>
                <li>
                    <strong>AWS CDK Bootstrap:</strong> Bootstrap CDK in <strong>both</strong> the Central Account and
                    the <span class="inline-code">workspace0</span> account for your chosen region. Run:
                    <pre><code class="language-bash"># In Central Account context
aws configure set region YOUR_REGION
cdk bootstrap aws://CENTRAL_ACCOUNT_ID/YOUR_REGION

# In workspace0 Account context
aws configure set region YOUR_REGION
cdk bootstrap aws://WORKSPACE0_ACCOUNT_ID/YOUR_REGION</code></pre>
                </li>
                <li>
                    <strong>Cross-Account Trust:</strong> Configure the <span class="inline-code">workspace0</span>
                    account to trust the Central Account. Create an IAM role in <span
                        class="inline-code">workspace0</span> (e.g., <span
                        class="inline-code">OndemandenvDeployerRole</span>) with AdministratorAccess (or a more
                    restricted policy based on least privilege later) that the Central Account can assume. The trust
                    policy should explicitly allow the role ARN that the ONDEMANDENV platform will use in the Central
                    Account (this will be defined by the platform template).
                </li>
                <li>
                    <strong>GitHub App Private Key Secret:</strong> Create a secret in AWS Secrets Manager within the
                    <strong>Central Account</strong>. Choose a specific name for this secret (e.g., <span
                        class="inline-code">ondemandenv/github-app-private-key</span>). You will store your GitHub App's
                    private key here in the next step. Note this secret name (<span class="inline-code">ghAppPrivateKeySecretName</span>).
                    The ONDEMANDENV platform template will require this name.
                </li>
            </ul>

            <h4>GitHub Environment:</h4>
            <ul>
                <li>
                    <strong>GitHub Organization:</strong> Ensure you have a GitHub Organization set up.
                </li>
                <li>
                    <strong>Private GitHub App:</strong> Create a new, private GitHub App owned by your organization.
                    <ul>
                        <li>Download the generated private key (.pem file).</li>
                        <li><strong>Important:</strong> Store the contents of this private key file securely as a new
                            version in the AWS Secrets Manager secret (<span class="inline-code">ghAppPrivateKeySecretName</span>)
                            you created in the Central Account.
                        </li>
                        <li>Configure necessary permissions for the App (refer to ONDEMANDENV documentation for
                            specifics, typically includes read access to code, metadata, and write access for issues,
                            pull requests, workflows, checks, statuses, deployments).
                        </li>
                        <li>Leave the Webhook URL blank for now; you will update this after deploying the platform.</li>
                        <li>Install this GitHub App on the specific repository you intend to use for your
                            `contractsLib`.
                        </li>
            </ul>
                </li>
                <li>
                    <strong>`contractsLib` Repository:</strong> Create a repository within your GitHub Organization to
                    define your service contracts. This repository will contain your ONDEMANDENV build and enver
                    definitions.
                    <ul>
                        <li>You can use <a
                                href="https://github.com/ondemandenv/odmd-contracts-sandbox/blob/main/lib/repos/_contracts/odmd-build-contracts-sbx.ts"
                                target="_blank" rel="noopener noreferrer">`ondemandenv/odmd-contracts-sandbox`</a> as an
                            example structure.
                        </li>
                        <li>Ensure your repository includes necessary dependencies (like
                            `@ondemandenv/odmd-contracts-base`) and build scripts (e.g., in `package.json`) to compile
                            your TypeScript definitions. The `@ondemandenv/odmd-contracts-base` package provides the core interfaces and base classes that your specific `contractsLib` will implement and extend to define your system's architecture and integrate with the ONDEMANDENV platform.
                        </li>
                        <li>You will need to package your compiled <span class="inline-code">contractsLib</span>
                            definition using <span
                                    class="inline-code">npm pack</span>. This generates a <span
                                    class="inline-code">.tgz</span> file.
                        </li>
                    </ul>
                </li>
            </ul>

            <h3 id="platform-deployment">2. Platform Deployment</h3>
            <ol>
                <li>
                    <strong>Submit Information to ONDEMANDENV Service:</strong>
                    You will need to provide the following information to the ONDEMANDENV service team (e.g., via email
                    or a setup portal):
                    <ul>
                        <li>Your packaged <span class="inline-code">contractsLib</span> definition file (<span
                                class="inline-code">.tgz</span>).
                        </li>
                        <li>The name of the hosted zone you created (e.g., <span class="inline-code">&lt;your-chosen-name&gt;.root.ondemandenv.link</span>).
                        </li>
                        <li>Your AWS Central Account ID.</li>
                        <li>The name you chose for the GitHub App private key secret (<span class="inline-code">ghAppPrivateKeySecretName</span>).
                        </li>
                        <li>The GitHub App ID.</li>
                    </ul>
                </li>
                <li>
                    <strong>Receive and Deploy Platform Template:</strong>
                    The ONDEMANDENV service team will use this information to prepare the core infrastructure template.
                    They will send back a CloudFormation template file (e.g., <span class="inline-code">odmd--central-artifact.template.json</span>).
                    Deploy this template into your <strong>Central Account</strong> using the AWS Console or CLI.
                    <pre><code class="language-bash">aws cloudformation deploy \
    --template-file path/to/odmd--central-artifact.template.json \
    --stack-name odmd-central-platform \
    --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM \
    --region YOUR_REGION</code></pre>
                    <em>(Note: Parameter overrides might be required depending on the template structure.)</em>
                    <p><em><strong>Important Notes on Resource Sharing:</strong></em></p>
                    <ul>
                        <li><em><strong>S3 Bucket for Artifacts:</strong> This stack will provision or configure an S3
                            bucket. This bucket is used by the platform (and potentially your CI/CD workflows) to store
                            deployment artifacts like CloudFormation templates. Ensure its policy allows access as
                            needed by the ONDEMANDENV service backend.</em></li>
                        <li><em><strong>SQS Queue for Notifications:</strong> The template configures integration with
                            an SQS queue provided by the ONDEMANDENV service. Your deployed stack resources (e.g.,
                            Lambda functions) will poll or be triggered by messages from this queue to receive
                            notifications or commands from the platform.</em></li>
                             </ul>
                        </li>
                <li>
                    <strong>Configure GitHub App Webhook:</strong>
                    <ul>
                        <li>Wait for the CloudFormation stack (<span class="inline-code">odmd-central-platform</span> or
                            similar name based on the template) to complete deployment successfully.
                        </li>
                        <li>Within the stack outputs, find the output named <span
                                class="inline-code">GithubWebHookUrl</span> (or similar).
                        </li>
                        <li>Go back to your GitHub App settings page on GitHub.</li>
                        <li>Paste this URL into the "Webhook URL" field.</li>
                        <li>Configure a Webhook secret if required by the platform template and enter it in the GitHub
                            App settings.
                        </li>
                        <li>Ensure the webhook is set to "Active".</li>
                     </ul>
                </li>
            </ol>
            <p>Once these steps are complete, the core ONDEMANDENV platform should be running in your Central Account
                and connected to your GitHub App. You can then proceed to the <a href="#core-workflow">Core Workflow</a>
                section to learn how to define and deploy your services.</p>
        </section>

        <section class="doc-section" id="core-workflow">
            <h2>Core Workflow & How-To Guide</h2>
            <p>Once the platform is running, here's the detailed workflow for defining, implementing, and managing a
                service Enver, incorporating common how-to tasks:</p>

            <h3 id="define-in-contractslib">1. Define a New Service & its Envers in `contractsLib`</h3>
            <p>Architecture, dependencies, and target environments are defined centrally. Edit your organization's <span
                    class="inline-code">contractsLib</span> repository (e.g., <span class="inline-code">&lt;your-org&gt;/my-contracts-lib-repo</span>).
            </p>
            <h4>Key Actions:</h4>
            <ul>
                <li><strong>Define Build Configuration (<span class="inline-code">OdmdBuild&lt;T&gt;</span>):</strong>
                    For each type of Enver (CDK, Cmd, Docker) associated with a source repository, create an instance of
                    <span class="inline-code">OdmdBuild&lt;T&gt;</span> (where T is <span class="inline-code">OdmdEnverCdk</span>,
                    <span class="inline-code">OdmdEnverCmd</span>, etc.). Provide the <span class="inline-code">githubRepoAlias</span>,
                    <span class="inline-code">buildType</span>, and any source paths/commands.
                </li>
                <li><strong>Define Enver(s) (<span class="inline-code">OdmdEnverCdk</span>, etc.):</strong> For each
                    specific branch/tag you want to manage, create an instance of the appropriate Enver class (e.g.,
                    <span class="inline-code">new OdmdEnverCdk(...)</span>). Link it to the corresponding <span
                            class="inline-code">OdmdBuild</span> instance. Specify the target AWS account alias (<span
                            class="inline-code">targetAccountAlias</span>) and region (<span class="inline-code">targetRegion</span>).
                    Use the Enver construct ID (e.g., 'OrderManagerDev') to represent the logical environment (often
                    related to the branch name). Mark production/staging Envers as immutable (<span class="inline-code">immutable: true</span>)
                    if they correspond to Git tags.
                </li>
                <li><strong>Declare Single Product (Convention):</strong> Within the Enver definition, declare <strong>one
                    primary <span class="inline-code">Product</span></strong> (conventionally named <span
                        class="inline-code">'Outputs'</span>) that will contain all shared outputs as a structured value
                    (usually JSON). Example: <span
                            class="inline-code">outputsProduct: new Product(this, 'Outputs')</span>.
                </li>
                <li><strong>Declare Consumers (How-To: Consume a Product):</strong> Within the Enver definition, declare
                    dependencies on Products from other Envers using <span class="inline-code">new Consumer(this, 'LocalConsumerName', otherEnver.outputsProduct, '{ /* Optional Default JSON */ }')</span>.
                    The 'LocalConsumerName' is how your CDK code will reference this consumed value (typically a JSON
                    string). Ensure Tag Envers only consume from other Tag Envers. Default values (provided as a JSON
                    string) can optionally be provided.
                </li>
            </ul>
            <h4>Example (<span class="inline-code">my-org-contracts.ts</span>):</h4>
            <pre><code class="language-typescript">// Example within your contractsLib repository (e.g., my-org-contracts.ts)
import { Construct } from 'constructs';
// Import base classes from the correct base library
import { OdmdContracts, OdmdBuild, OdmdEnverCdk, OdmdEnverCmd, Product, Consumer } from '@ondemandenv/odmd-contracts-base';
// Import other Enver definitions if needed for dependency references
// import { FoundationEnver } from './foundation-stack'; // Assuming Foundation publishes products

// Your main contracts class extends OdmdContracts
export class MyOrgContracts extends OdmdContracts {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    // --- Foundational Build/Enver (Example - Assuming it exists and has 'Outputs' product) ---
    // const foundationBuild = new OdmdBuild<FoundationEnver>(...) // Define build for FoundationEnver type
    // const foundationDev = new FoundationEnver(this, 'FoundationDev', { build: foundationBuild, ... });
    // const foundationProd = new FoundationEnver(this, 'FoundationProd', { build: foundationBuild, immutable: true, ... });

    // --- Build Configuration for the 'npm' Commands Enver (example for contractsLib itself) ---
    const npmCmdsBuild = new OdmdBuild<OdmdEnverCmd>(this, 'odmd-contracts-npm-CmdsGH', {
      githubRepoAlias: 'my-contracts-lib-repo', // Alias for THIS contractsLib repo
      buildType: 'cmd', // Uses custom commands
      buildCommand: 'npm run build && npm pack',
    });

    // --- Enver for the 'npm' Commands (example: deploying to workspace0) ---
    // Enver ID ('us-east-1-workspace0') often combines region and account alias
    const npmCmdsDev = new OdmdEnverCmd(this, 'us-east-1-workspace0', {
      build: npmCmdsBuild, // Link to the build config
      targetAccountAlias: 'workspace0',
      targetRegion: 'us-east-1',
      // Typically no product/consumer for a simple command runner like this
    });

    // --- Build Configuration for Order Manager Service (CDK type) ---
    const orderManagerBuild = new OdmdBuild<OdmdEnverCdk>(this, 'OrderManagerBuild', {
        githubRepoAlias: 'order-manager-service', // Alias for the service repo
      buildType: 'cdk',
        sourcePath: 'infra/' // Path to CDK app within the repo
    });

    // --- Enver Definition for Order Manager 'dev' Branch --- 
    const orderManagerDev = new OdmdEnverCdk(this, 'OrderManagerDev', {
        build: orderManagerBuild, // Link to the build config
        targetAccountAlias: 'workspace0', // Deploying to workspace0 in example
      targetRegion: 'us-east-1',
        immutable: false, // Branch Enver

        // Product published by this Enver (convention: single 'Outputs' product)
        outputsProduct: new Product(this, 'Outputs'),

        // Consumers (Example)
        // Note: Use otherEnver.outputsProduct to reference the dependency's output product
        // Example Consumer with a default value (JSON string)
        // Assuming userPoolDev is another Enver defined elsewhere with an 'outputsProduct'
        userPoolOutputsConsumer: new Consumer(this, 'UserPoolOutputs', /* userPoolDev.outputsProduct */ undefined,
             '{ "userPoolId": "default-pool-id", "userPoolClientId": "default-client-id" }' // Default JSON string
        ),
        // Example Consumer without default (will fail deployment if foundationDev dependency unavailable)
        // foundationOutputsConsumer: new Consumer(this, 'FoundationOutputs', foundationDev.outputsProduct),
    });

    // --- Enver Definition for Order Manager 'prod' Tag (Immutable) --- 
     const orderManagerProd = new OdmdEnverCdk(this, 'OrderManagerProd', {
        build: orderManagerBuild, // Link to the build config
        targetAccountAlias: 'workspace0', // Example: deploying prod to workspace0 too
        targetRegion: 'us-east-1',
        immutable: true, // Tag Enver

        // Product published by this Enver (convention: single 'Outputs' product)
        outputsProduct: new Product(this, 'Outputs'),

        // Consumers (Must consume from other *immutable* Envers)
        // Assuming foundationProd is an immutable Enver defined elsewhere
        // foundationOutputsConsumer: new Consumer(this, 'FoundationOutputs', foundationProd.outputsProduct),
    });

    // ... Define other builds/envers ...
  }
}
</code>
            </pre>
            <p><strong>Commit, PR, Merge:</strong> Follow standard Git workflow for the <span class="inline-code">contractsLib</span>
                repo.</p>
            <p><strong>Platform Synchronization:</strong> Merging triggers the <span
                    class="inline-code">contractsLib</span> pipeline, which publishes updates and notifies the platform.
                The platform then generates/updates the specific CI/CD workflow file (e.g., <span class="inline-code">.github/workflows/ODMD_OrderManagerDev_*.yaml</span>)
                in the service repository (<span class="inline-code">order-manager-service</span>).</p>

            <h3 id="implement-service">2. Implement the Service (CDK Stack / Dockerfile / Script)</h3>
            <p>In the service's repository (e.g., <span class="inline-code">order-manager-service</span>), implement the
                logic and infrastructure definitions.</p>
            <h4>How-To: Consume a Product in CDK</h4>
            <p>Within your CDK stack class (extending <span class="inline-code">OdmdEnverCdk</span> from <span
                    class="inline-code">@ondemandenv/odmd-contracts-base</span>), use the static method <span
                    class="inline-code">OdmdEnverCdk.getSharedValue('LocalConsumerName')</span> to retrieve the concrete
                value (typically a JSON string) during synthesis. The 'LocalConsumerName' must match the ID given in the
                <span class="inline-code">Consumer</span> definition in `contractsLib`. You will likely need to parse
                this JSON string to access individual values.</p>
            <h4>How-To: Publish a Product from CDK</h4>
            <p>Instantiate the <strong>single allowed</strong> <span class="inline-code">OdmdShareOut</span> construct
                per stack (from <span class="inline-code">@ondemandenv/odmd-contracts-base</span>). To publish multiple
                values, structure them as an object, serialize it to JSON using <span class="inline-code">cdk.Stack.of(this).toJsonString(...)</span>,
                and publish the string. The ID used for <span class="inline-code">OdmdShareOut</span> (e.g., <span
                        class="inline-code">'Outputs'</span>) MUST match the corresponding <span class="inline-code">Product</span>
                ID declared in `contractsLib`.</p>
            <pre><code class="language-typescript">// Example: order-manager-service/infra/lib/order-manager-stack.ts
import * as cdk from 'aws-cdk-lib';
import { Construct } from 'constructs';
import * as sqs from 'aws-cdk-lib/aws-sqs';
import * as lambda from 'aws-cdk-lib/aws-lambda';
import * as lambdaNode from 'aws-cdk-lib/aws-lambda-nodejs'; // For simplified Node.js Lambda bundling
import * as apigw from 'aws-cdk-lib/aws-apigateway';
import * as path from 'path';
// Ensure this import reflects your setup for the base library
import { OdmdEnverCdk, OdmdShareOut } from '@ondemandenv/odmd-contracts-base';

// Interface for parsed UserPool outputs (example)
interface UserPoolOutputs {
    userPoolId: string;
    userPoolClientId: string;
}

// Your stack extends the base OdmdEnverCdk class
export class OrderManagerStack extends OdmdEnverCdk {
  constructor(scope: Construct, id: string, props?: cdk.StackProps) {
    super(scope, id, props);

    // --- Consume structured values defined as Consumers in contractsLib --- 
    // Retrieve the JSON string using the local consumer name
    const userPoolOutputsJson = OdmdEnverCdk.getSharedValue('UserPoolOutputs'); 
    // Parse the JSON string to access individual properties (add error handling as needed)
    const userPoolOutputs: UserPoolOutputs = JSON.parse(userPoolOutputsJson || '{}'); 
    const userPoolId = userPoolOutputs.userPoolId; // Example access

    // --- Create resources specific to this Enver --- 
    const orderQueue = new sqs.Queue(this, 'OrderQueue', {
        // Provide a unique name based on the Enver ID suffix
        queueName: `order-manager-queue-${OdmdEnverCdk.getEnverIdSuffix()}.fifo`, // Example: FIFO queue
        fifo: true,
        retentionPeriod: cdk.Duration.days(4),
        // encryption: sqs.QueueEncryption.KMS_MANAGED, // Consider encryption
    });

    // Example using NodejsFunction for easier bundling
    const orderHandlerLambda = new lambdaNode.NodejsFunction(this, 'OrderHandlerLambda', {
        // Adjust path relative to CDK app root (e.g., infra/)
        entry: path.join(__dirname, '../../src/lambda/order-handler.ts'), // Example path to lambda code
        runtime: lambda.Runtime.NODEJS_LATEST, // Specify runtime
        handler: 'handler', // Function entry point
        bundling: { // Example bundling options
            minify: true,
            externalModules: ['@aws-sdk/*'], // Exclude AWS SDK v3 if using Lambda layer or built-in
        },
        environment: {
            // Use consumed & parsed values if needed
            USER_POOL_ID: userPoolId,
            QUEUE_URL: orderQueue.queueUrl,
        }
        // ... potentially configure VPC, memorySize, timeout etc. ...
    });

    // Grant lambda permissions to interact with queue
    orderQueue.grantSendMessages(orderHandlerLambda);
    // Grant other permissions as needed (e.g., DynamoDB access)

    // Example API Gateway
    const api = new apigw.RestApi(this, 'OrderManagerApi', {
        restApiName: `order-manager-api-${OdmdEnverCdk.getEnverIdSuffix()}`,
        description: `API for Order Manager (${OdmdEnverCdk.getEnverIdSuffix()})`,
        deployOptions: {
            stageName: 'v1', // Example stage name
        },
        // defaultCorsPreflightOptions: { ... } // Consider CORS
    });
    // Define API resources and methods
    const ordersResource = api.root.addResource('orders');
    ordersResource.addMethod('POST', new apigw.LambdaIntegration(orderHandlerLambda));

    // --- Structure and Publish Outputs via the SINGLE OdmdShareOut --- 
    // 1. Create an object containing the outputs you want to share
    const outputsObject = {
        apiUrl: api.url,
        apiId: api.restApiId,
        queueArn: orderQueue.queueArn,
        queueUrl: orderQueue.queueUrl,
        handlerLambdaArn: orderHandlerLambda.functionArn,
        // Add other relevant outputs here
    };

    // 2. Use the SINGLE OdmdShareOut construct to publish the JSON string
    // The second argument ('Outputs') MUST match the Product ID in contractsLib
    new OdmdShareOut(this, 'Outputs', {
         value: cdk.Stack.of(this).toJsonString(outputsObject)
    });
  }
}
```
            </code>
</pre>

            <h3 id="deploy-iterate">3. Deploy & Iterate</h3>
            <p>Once your service is implemented, you can deploy it to the target environment. The platform automates the
                deployment process based on Git events and dependency updates.</p>
            <h4>Key Actions & Triggers:</h4>
            <ul>
                <li><strong>Code Change Trigger:</strong> Pushing commits to a branch in the service repository triggers
                    the deployment pipeline **if** that branch corresponds to a Branch Enver defined in <code>contractsLib</code>
                    (e.g., pushing to <code>dev</code> triggers the 'ServiceNameDev' Enver pipeline).
                </li>
                <li><strong>Dependency Update Trigger:</strong> If an Enver consumes a Product from another Enver
                    (Producer), an update to that consumed Product (i.e., the Producer deploys a new version) will
                    automatically trigger a deployment of the consuming Enver to ensure it uses the latest dependency
                    version.
                </li>
                <li><strong>Monitoring Deployment:</strong> Monitor the deployment process (triggered by any of the
                    above) in the GitHub Actions tab (or your configured CI/CD system) of the service repository.
                </li>
                <li><strong>Verification:</strong> Verify the successful deployment by checking the AWS CloudFormation
                    stack status and relevant resources in the target account, or by interacting with the deployed
                    service endpoint.
                </li>
                <li><strong>Iteration:</strong> Continue iterating by pushing code changes, which will trigger
                    subsequent automated deployments.
                </li>
            </ul>

            <h3 id="clone-enver">4. Clone an Enver</h3>
            <p>You can clone an existing Enver to create a new one with a different configuration or target environment.
                This is useful for creating a staging environment, testing new features, or deploying to a different
                AWS account.</p>
            <h4>Key Actions:</h4>
            <ul>
                <li><strong>Define Clone in `contractsLib`:</strong> In your <span
                        class="inline-code">contractsLib</span>
                    repository, define a new Enver that clones an existing one. Specify the source Enver, the new target
                    environment, and any additional configuration.
                </li>
                <li><strong>Trigger Cloning:</strong> Trigger the cloning process by merging the changes into the
                    <span class="inline-code">contractsLib</span> repository.
                </li>
                <li><strong>Monitor Cloning:</strong> Monitor the cloning process in the GitHub Actions tab of the
                    <span class="inline-code">contractsLib</span> repository.
                </li>
                <li><strong>Verify Cloning:</strong> Verify the successful cloning by checking the AWS CloudFormation
                    stack in the target account.
                </li>
            </ul>

            <h3 id="delete-clone">5. Delete a Clone</h3>
            <p>When you no longer need a cloned Enver, you can delete it to clean up resources and avoid unnecessary
                costs.</p>
            <h4>Key Actions:</h4>
            <ul>
                <li><strong>Remove from `contractsLib`:</strong> In your <span class="inline-code">contractsLib</span>
                    repository, remove the definition of the cloned Enver.
                </li>
                <li><strong>Trigger Deletion:</strong> Trigger the deletion process by merging the changes into the
                    <span class="inline-code">contractsLib</span> repository.
                </li>
                <li><strong>Monitor Deletion:</strong> Monitor the deletion process in the GitHub Actions tab of the
                    <span class="inline-code">contractsLib</span> repository.
                </li>
                <li><strong>Verify Deletion:</strong> Verify the successful deletion by checking that the AWS
                    CloudFormation stack has been deleted in the target account.
                </li>
            </ul>

            <h3 id="dynamic-cloning">Dynamic/Ephemeral Cloning</h3>
            <p>In addition to static clones defined in <span class="inline-code">contractsLib</span>, ONDEMANDENV supports dynamic, ephemeral cloning for rapid development and testing. These clones are temporary environments that can be created and destroyed on-demand.</p>
            
            <h4>Method 1: Manual Clone Commands</h4>
            <p>Create dynamic clones using special commands in Git commit messages:</p>
            
            <h5>Creating a Dynamic Clone:</h5>
            <ol>
                <li><strong>Create Feature Branch:</strong> Create a new feature branch from your base branch:
                    <pre><code>git checkout -b feature/new-feature
# Make your code changes
git add .
git commit -m "Implement new feature

odmd: create@myServiceDev"</code></pre>
                </li>
                <li><strong>Push to Trigger Clone:</strong> Push your branch to trigger the platform:
                    <pre><code>git push origin feature/new-feature</code></pre>
                </li>
                <li><strong>Platform Creates Clone:</strong> ONDEMANDENV automatically:
                    <ul>
                        <li>Creates a dynamic Enver for your feature branch</li>
                        <li>Inherits dependency versions from the source Enver</li>
                        <li>Deploys isolated infrastructure with unique resource names</li>
                        <li>Provides endpoints for your isolated environment</li>
                    </ul>
                </li>
            </ol>

            <h5>Deleting a Dynamic Clone:</h5>
            <pre><code>git commit --allow-empty -m "Cleanup feature environment

odmd: delete"
git push origin feature/new-feature</code></pre>

            <h4>Method 2: Automated PR-Based Cloning</h4>
            <p>ONDEMANDENV provides fully automated cloning that integrates seamlessly with Pull Request workflows:</p>
            
            <h5>Automated Workflow:</h5>
            <ol>
                <li><strong>Create Feature Branch & Push:</strong> Create and push your feature branch as usual:
                    <pre><code>git checkout -b feature/user-dashboard
# Make your changes
git commit -m "Redesign user dashboard"
git push origin feature/user-dashboard</code></pre>
                </li>
                <li><strong>Create Pull Request:</strong> Create a PR targeting a branch with a static Enver:
                    <pre><code>gh pr create --base dev --head feature/user-dashboard \
  --title "User Dashboard Redesign" \
  --body "Implements new responsive design"</code></pre>
                </li>
                <li><strong>Automatic Clone Creation:</strong> When the PR targets a branch with a static Enver in <span class="inline-code">contractsLib</span>, the platform automatically:
                    <ul>
                        <li>Detects the PR creation</li>
                        <li>Creates a dynamic Enver for the PR branch</li>
                        <li>Deploys the isolated environment</li>
                        <li>Updates the PR with environment details</li>
                    </ul>
                </li>
                <li><strong>Automatic Updates:</strong> Additional commits to the PR branch automatically update the dynamic environment</li>
                <li><strong>Automatic Cleanup:</strong> When the PR is closed or merged, the platform automatically destroys the dynamic Enver and cleans up all resources</li>
            </ol>

            <h4>Benefits of Dynamic Cloning:</h4>
            <ul>
                <li><strong>Isolated Testing:</strong> Each feature gets its own complete environment</li>
                <li><strong>Dependency Consistency:</strong> Clones inherit exact dependency versions from source Envers</li>
                <li><strong>Resource Isolation:</strong> Unique resource naming prevents conflicts</li>
                <li><strong>Automatic Cleanup:</strong> No forgotten environments consuming resources (especially with PR-based method)</li>
                <li><strong>Rapid Iteration:</strong> Quick environment provisioning for fast feedback cycles</li>
                <li><strong>Full Stack Testing:</strong> Complete infrastructure and application testing in isolation</li>
            </ul>

            <h4>Requirements for PR-Based Automation:</h4>
            <ul>
                <li><strong>Static Enver Mapping:</strong> Target branch must have a corresponding static Enver in <span class="inline-code">contractsLib</span></li>
                <li><strong>GitHub App Permissions:</strong> Platform needs appropriate permissions to monitor PR events</li>
                <li><strong>Branch Name Matching:</strong> PR target branch names must match Git branch references in static Enver definitions</li>
            </ul>

            <h4>Comparison of Dynamic Cloning Methods:</h4>
            <table style="width: 100%; border-collapse: collapse; margin: 1rem 0; font-size: 0.9em;">
                <thead>
                    <tr style="background-color: #f8f9fa;">
                        <th style="border: 1px solid #ddd; padding: 0.5rem; text-align: left;">Aspect</th>
                        <th style="border: 1px solid #ddd; padding: 0.5rem; text-align: left;">Manual Commands</th>
                        <th style="border: 1px solid #ddd; padding: 0.5rem; text-align: left;">PR-Based Automation</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;"><strong>Trigger</strong></td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;"><span class="inline-code">odmd: create@</span> in commit</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">PR creation against static Enver branch</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;"><strong>Cleanup</strong></td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;"><span class="inline-code">odmd: delete</span> in commit</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">PR closure (merge/close)</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;"><strong>Use Case</strong></td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">Ad-hoc testing, experimentation</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">Standard development workflow</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;"><strong>Automation Level</strong></td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">Manual control</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">Fully automated</td>
                    </tr>
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;"><strong>Integration</strong></td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">Git commits</td>
                        <td style="border: 1px solid #ddd; padding: 0.5rem;">GitHub/GitLab workflow</td>
                    </tr>
                </tbody>
            </table>

            <h3 id="use-platform-services">Use Platform Services</h3>
            <p>The ONDEMANDENV platform provides additional services to enhance your development and deployment
                experience.</p>
            <h4>Key Services:</h4>
            <ul>
                <li><strong>ONDEMANDENV Console:</strong> A web-based interface that visualizes your environments,
                    builds,
                    and their relationships. It provides real-time versioning information, status monitoring, and Enver
                    details. Access it at <a href="https://web.auth.ondemandenv.link/?region=us-west-1"
                                             target="_blank">web.auth.ondemandenv.link</a>.
                </li>
                <li><strong>CI/CD Integration:</strong> Seamless integration with your preferred CI/CD tools (e.g.,
                    GitHub Actions) to automate the deployment process.
                </li>
                <li><strong>Isolated Testing:</strong> Isolate your tests in dedicated environments to ensure they don't
                    interfere with production or other development efforts.
                </li>
                <li><strong>Shared Networking:</strong> Share networking resources across Envers to optimize costs and
                    improve performance.
                </li>
                <li><strong>Shared EKS:</strong> Share a single Elastic Kubernetes Service (EKS) cluster across multiple
                    Envers for better resource utilization and cost savings.
                </li>
            </ul>
        </section>

        <section class="doc-section" id="deployment-model">
            <h2>Deployment Model</h2>
            <p>The ONDEMANDENV platform follows a unique deployment model that combines the benefits of both monolithic
                and microservices architectures.</p>

            <h3>Key Concepts:</h3>
            <ul>
                <li><strong>Envers:</strong> An Enver represents a logical environment or version of a service. It can
                    be
                    a branch, a tag, or a specific configuration. Envers are defined in the <span
                            class="inline-code">contractsLib</span> repository.
                </li>
                <li><strong>Builds:</strong> A build is the process of packaging and preparing the service for
                    deployment.
                    Builds are defined in the <span class="inline-code">contractsLib</span> repository.
                </li>
                <li><strong>Producers & Consumers:</strong> Producers are Envers that publish shared outputs (products)
                    that other Envers (consumers) can consume. This enables a modular and decoupled architecture.
                </li>
                <li><strong>Deployment Workflow:</strong> The platform automates the deployment process, including
                    building the service, packaging the artifacts, and deploying the infrastructure.
                </li>
            </ul>

            <h3>Benefits:</h3>
            <ul>
                <li><strong>Modularity:</strong> Services are decoupled and modular, allowing for independent
                    development
                    and deployment.
                </li>
                <li><strong>Isolation:</strong> Envers are isolated from each other, ensuring that changes in one
                    environment don't affect others.
                </li>
                <li><strong>Scalability:</strong> The platform can handle a large number of Envers and builds,
                    supporting both small and large-scale deployments.
                </li>
                <li><strong>Flexibility:</strong> Envers can be cloned to create new environments with different
                    configurations or targets.
                </li>
                <li><strong>Cost Optimization:</strong> Shared resources and infrastructure can lead to cost savings
                    compared to traditional microservices architectures.
                </li>
            </ul>
        </section>

        <section class="doc-section" id="security">
            <h2>Security Considerations</h2>
            <p>Security is a top priority in the ONDEMANDENV platform. Here are some key security considerations:</p>

            <h3>Access Control:</h3>
            <ul>
                <li><strong>Role-Based Access Control (RBAC):</strong> Fine-grained access control is implemented using
                    IAM roles and policies.
                </li>
                <li><strong>Least Privilege:</strong> Principals are granted the minimum permissions necessary to
                    perform their tasks.
                </li>
                <li><strong>Separation of Duties:</strong> Different roles are responsible for different aspects of the
                    platform, reducing the risk of unauthorized access.
                </li>
            </ul>

            <h3>Data Protection:</h3>
            <ul>
                <li><strong>Encryption at Rest:</strong> Sensitive data is encrypted at rest using AWS Key Management
                    Service (KMS).
                </li>
                <li><strong>Encryption in Transit:</strong> Data is encrypted in transit using SSL/TLS.
                </li>
                <li><strong>Data Isolation:</strong> Envers are isolated from each other, ensuring that data from one
                    environment doesn't leak into another.
                </li>
                    </ul>

            <h3>Infrastructure Security:</h3>
            <ul>
                <li><strong>Network Isolation:</strong> Envers are isolated using VPCs, subnets, and security groups.
                </li>
                <li><strong>Intrusion Detection:</strong> AWS services like AWS GuardDuty and AWS Inspector are used for
                    intrusion detection and vulnerability scanning.
                </li>
                <li><strong>Patch Management:</strong> Automated patch management is implemented using AWS Systems
                    Manager.
                </li>
            </ul>

            <h3>Compliance:</h3>
            <ul>
                <li><strong>SOX Compliance:</strong> The platform is designed to meet the requirements of the
                    Sarbanes-Oxley
                    Act (SOX).
                </li>
                <li><strong>HIPAA Compliance:</strong> The platform is designed to meet the requirements of the Health
                    Insurance Portability and Accountability Act (HIPAA).
                </li>
                <li><strong>PCI DSS Compliance:</strong> The platform is designed to meet the requirements of the
                    Payment
                    Card Industry Data Security Standard (PCI DSS).
                </li>
            </ul>
        </section>

        <section class="doc-section" id="cicd">
            <h2>CI/CD Integration</h2>
            <p>The ONDEMANDENV platform integrates seamlessly with your preferred CI/CD tools to automate the deployment
                process.</p>

            <h3>Key Features:</h3>
            <ul>
                <li><strong>GitHub Actions:</strong> The platform is designed to work with GitHub Actions, allowing you
                    to
                    define and automate your CI/CD workflows directly in your <span
                            class="inline-code">contractsLib</span> repository.
                </li>
                <li><strong>Customizable Workflows:</strong> You can customize the CI/CD workflows to meet your specific
                    needs, including testing, building, and deploying.
                </li>
                <li><strong>Integration with ONDEMANDENV Console:</strong> The CI/CD workflows are integrated with the
                    ONDEMANDENV Console, providing real-time visibility into the deployment process.
                </li>
                <li><strong>Isolated Testing:</strong> The platform supports isolated testing environments, ensuring
                    that
                    your tests don't interfere with production or other development efforts.
                </li>
            </ul>

            <h3>Example Workflow:</h3>
            <ol>
                <li><strong>Trigger:</strong> A change is merged into the <span class="inline-code">dev</span> branch
                    of the service repository.
                </li>
                <li><strong>Build:</strong> The CI/CD workflow is triggered, and the service is built using the
                    specified build configuration.
                </li>
                <li><strong>Test:</strong> The service is tested in an isolated environment to ensure it functions
                    correctly.
                </li>
                <li><strong>Deploy:</strong> If the tests pass, the service is deployed to the <span
                        class="inline-code">dev</span> Enver.
                </li>
                <li><strong>Notify:</strong> The ONDEMANDENV Console is notified of the successful deployment, and the
                    status is updated.
                </li>
            </ol>
        </section>

         <section class="doc-section" id="base-library">
            <h2>Base Library</h2>
            <p>The ONDEMANDENV platform provides a crucial base library, published as <a href="https://github.com/ondemandenv/odmd-contracts-base" target="_blank" rel="noopener noreferrer"><code class="inline-code">@ondemandenv/odmd-contracts-base</code></a>. This library is fundamental to the platform's operation, serving as the definitive contract between all user-defined builds/envers and the central ONDEMANDENV system. It supplies the essential TypeScript base classes and interfaces that your organization's <code>contractsLib</code> repository will use.</p>
            <p>When you create your own <code>contractsLib</code> (like the example <a href="https://github.com/ondemandenv/odmd-contracts-sandbox" target="_blank" rel="noopener noreferrer"><code class="inline-code">odmd-contracts-sandbox</code></a>), you will extend these base classes. This extension mechanism is key to how the platform understands your architecture and, critically, how your specific services (including custom console implementations) bridge to the central platform's capabilities, such as AWS AppSync for real-time data synchronization.</p>
            <p>For instance, a common pattern is for a user-defined contract for console authentication, like <a href="https://github.com/ondemandenv/odmd-contracts-sandbox/blob/main/lib/repos/_user-auth/OdmdBuildUserAuthSbx.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">OdmdBuildUserAuthSbx.ts</code></a> from the sandbox, to extend a corresponding base class from <a href="https://github.com/ondemandenv/odmd-contracts-base/blob/main/lib/repos/__user-auth/odmd-build-user-auth.ts" target="_blank" rel="noopener noreferrer"><code class="inline-code">odmd-build-user-auth.ts</code></a> in <code>@ondemandenv/odmd-contracts-base</code>. This ensures that your implementation correctly interacts with the platform's expectations for authentication and data exchange with services like AppSync.</p>

            <h3>Key Features:</h3>
            <ul>
                <li><strong>TypeScript:</strong> The base library is written in TypeScript, providing strong typing and
                    improved developer experience.
                </li>
                <li><strong>Extensible:</strong> The library is designed to be extensible, allowing you to customize and
                    extend its functionality as needed.
                </li>
                <li><strong>Modular:</strong> The library is modular, with separate modules for different aspects of the
                    platform, such as contracts, builds, and Envers.
                </li>
                <li><strong>Documentation:</strong> The library is well-documented, with detailed API documentation and
                    examples.
                </li>
                    </ul>

            <h3>Example Usage:</h3>
            <pre><code class="language-typescript">// Example usage of the base library
import { Construct } from 'constructs';
import { OdmdContracts, OdmdBuild, OdmdEnverCdk, Product, Consumer } from '@ondemandenv/odmd-contracts-base';

export class MyServiceContracts extends OdmdContracts {
  constructor(scope: Construct, id: string) {
    super(scope, id);

    const myServiceBuild = new OdmdBuild<OdmdEnverCdk>(this, 'MyServiceBuild', {
      githubRepoAlias: 'my-service-repo',
      buildType: 'cdk',
      sourcePath: 'infra/',
    });

    const myServiceDev = new OdmdEnverCdk(this, 'MyServiceDev', {
      build: myServiceBuild,
      targetAccountAlias: 'workspace0',
      targetRegion: 'us-east-1',
      immutable: false,
      outputsProduct: new Product(this, 'Outputs'),
    });

    const myServiceProd = new OdmdEnverCdk(this, 'MyServiceProd', {
      build: myServiceBuild,
      targetAccountAlias: 'workspace0',
      targetRegion: 'us-east-1',
      immutable: true,
      outputsProduct: new Product(this, 'Outputs'),
    });
  }
}
</code></pre>
        </section>

        <section class="doc-section" id="explore-code">
            <h2>Explore the Code</h2>
            <p>The ONDEMANDENV platform is open source, and its code is available on GitHub. You can explore the code
                and contribute to its development.</p>

            <h3>Key Repositories:</h3>
            <ul>
                <li><strong>Platform Core:</strong> <a href="https://github.com/ondemandenv/odmd-platform-core"
                                                       target="_blank">github.com/ondemandenv/odmd-platform-core</a>
                </li>
                <li><strong>Base Library:</strong> <a href="https://github.com/ondemandenv/odmd-contracts-base"
                                                      target="_blank">github.com/ondemandenv/odmd-contracts-base</a>
                </li>
                <li><strong>Example Contracts:</strong> <a href="https://github.com/ondemandenv/odmd-contracts-sandbox"
                                                           target="_blank">github.com/ondemandenv/odmd-contracts-sandbox</a>
                </li>
            </ul>

            <h3>Contributing:</h3>
            <p>We welcome contributions to the ONDEMANDENV platform. If you're interested in contributing, please
                review our <a href="#contributing">Contributing Guidelines</a>.</p>
        </section>

        <section class="doc-section" id="platform-internals">
            <h2>Platform Internals</h2>
            <p>This section provides an overview of the internal workings of the ONDEMANDENV platform.</p>

            <h3>Architecture:</h3>
            <p>The platform is built on a microservices architecture, with separate services responsible for different
                aspects of the platform. The main services include:</p>
            <ul>
                <li><strong>Contracts Service:</strong> Manages the contractsLib repository and generates the CI/CD
                    workflows.
                </li>
                <li><strong>Build Service:</strong> Builds the service artifacts based on the build configuration.
                </li>
                <li><strong>Deployment Service:</strong> Deploys the service artifacts to the target environment.
                </li>
                <li><strong>Console Service:</strong> Provides the ONDEMANDENV Console web interface.
                </li>
                    </ul>

            <h3>Data Flow:</h3>
            <p>The data flow within the platform is as follows:</p>
            <ol>
                <li><strong>Contracts:</strong> The contractsLib repository defines the contracts for the platform,
                    including the build configurations and Enver definitions.
                 </li>
                <li><strong>CI/CD Workflows:</strong> The Contracts Service generates the CI/CD workflows based on the
                    contracts.
                </li>
                <li><strong>Build:</strong> The Build Service builds the service artifacts based on the build
                    configuration.
                </li>
                <li><strong>Deployment:</strong> The Deployment Service deploys the service artifacts to the target
                    environment.
                </li>
                <li><strong>Console:</strong> The Console Service provides real-time visibility into the platform,
                    including the status of Envers and the relationships between them.
                </li>
            </ol>

            <h3>Security:</h3>
            <p>The platform implements various security measures to ensure the confidentiality, integrity, and
                availability of the data and services. For more details, refer to the <a href="#security">Security
                    Considerations</a> section.</p>

            <h3>Scalability:</h3>
            <p>The platform is designed to scale horizontally, allowing it to handle a large number of Envers and
                builds.
                The services are stateless and can be scaled independently based on the workload.</p>

            <h3>Reliability:</h3>
            <p>The platform is designed to be highly reliable, with redundant components and automated failover
                mechanisms. The services are deployed across multiple availability zones to ensure high
                availability.</p>
        </section>

        <section class="doc-section" id="console">
            <h2>ONDEMANDENV Console</h2>

            <h3 id="console-overview">Overview</h3>
            <p>The ONDEMANDENV Console serves as the primary user interface for visualizing and interacting with your
                environments, builds, and their relationships within the platform. After logging in (typically via
                Google OAuth integrated with your organization's identity provider), the console connects securely to
                the central AppSync API in your AWS environment.</p>
            <p>Its main focus is to provide clarity on the complex web of dependencies inherent in distributed systems,
                leveraging the information codified in your <code>contractsLib</code>.</p>

            <h3 id="console-auth-setup">Console Authentication Setup</h3>
            <p>To enable user authentication for the console, you will need to configure Google OAuth 2.0. This process
                involves:</p>
            <ul>
                <li>Setting up an OAuth 2.0 client ID in the Google Cloud Console.</li>
                <li>Obtaining a <strong>Google Client ID</strong> and a <strong>Google Client Secret</strong>.</li>
                <li>These credentials must then be securely incorporated into your <code>contractsLib</code>
                    definitions. This typically involves referencing them as secure parameters or secrets that the
                    console's backend infrastructure (defined via an Enver in <code>contractsLib</code>) can access.
                </li>
                <li>For an example of how these credentials are referenced within <code>contractsLib</code> for a user
                    authentication service that the console would rely on, see the <a
                            href="https://github.com/ondemandenv/odmd-contracts-sandbox/blob/main/lib/repos/_user-auth/OdmdBuildUserAuthSbx.ts"
                            target="_blank"><code>OdmdBuildUserAuthSbx.ts</code> example</a> in the sandbox contracts.
                    This example file typically extends a base authentication contract class (e.g., <a href="https://github.com/ondemandenv/odmd-contracts-base/blob/main/lib/repos/__user-auth/odmd-build-user-auth.ts" target="_blank" rel="noopener noreferrer"><code>odmd-build-user-auth.ts</code></a>) from the <code>@ondemandenv/odmd-contracts-base</code> library, demonstrating how your specific console authentication setup connects with the central platform logic, often involving services like AWS AppSync.
                </li>
                    </ul>
            <p>Proper configuration of these OAuth credentials and their integration into your <code>contractsLib</code>
                is essential for the console's login functionality and secure access to real-time data.</p>

            <h3 id="console-features">Key Features</h3>
            <ul>
                <li><strong>Dependency Visualization:</strong> Clearly shows how builds (producers) and Envers
                    (consumers) depend on each other, based on the contracts defined in <code>contractsLib</code>.
                </li>
                <li><strong>Real-time Versioning Information:</strong> Connects to AWS AppSync in the central account to
                    fetch live data about all producer build versions and consumer Enver deployments.
                </li>
                <li><strong>Status Monitoring:</strong> Indicates whether a consumer Enver is using an up-to-date
                    version of a producer build, is lagging behind, or if a required dependency hasn't been deployed
                    yet.
                </li>
                <li><strong>Enver Details:</strong> Displays specific details for each Enver, such as the exact version
                    of the <code>contractsLib</code> it's using, derived from real-time AWS Stack summaries.
                </li>
                <li><strong>Secure Access:</strong> Uses Google OAuth for authentication, ensuring only authorized users
                    can access the console and system data.
                </li>
            </ul>

            <h3 id="console-example">Example Access</h3>
            <p>You can explore a live example of the ONDEMANDENV console configured for the demonstration organization
                hosted on GitHub (<a href="https://github.com/ondemandenv" target="_blank">github.com/ondemandenv</a>).
                Access it here:</p>
            <p><a href="https://web.auth.ondemandenv.link/?region=us-west-1" target="_blank" class="repo-link">Example
                Console (web.auth.ondemandenv.link)</a></p>
            <p>Note: Access to specific data within the example console may require appropriate permissions tied to the
                example organization's authentication setup.</p>
        </section>


        <section id="support" class="doc-section">
            <h2>Support</h2>
            <p>If you need help or have any questions about the ONDEMANDENV platform, please don't hesitate to reach out
                to our support team.</p>

            <h3>Contact Information:</h3>
            <ul>
                <li><strong>Email:</strong> <a href="mailto:support@ondemandenv.dev">support@ondemandenv.dev</a></li>
                <!--<li><strong>Discord:</strong> <a href="https://discord.gg/ondemandenv" target="_blank">discord.gg/ondemandenv</a>-->
                </li>
            </ul>

            <h3>Additional Resources:</h3>
            <ul>
                <li><strong>Documentation:</strong> <a href="documentation.html">ONDEMANDENV Documentation</a></li>
                <li><strong>GitHub:</strong> <a href="https://github.com/ondemandenv" target="_blank">ONDEMANDENV GitHub
                    Organization</a></li>
                <!--<li><strong>Blog:</strong> <a href="https://blog.ondemandenv.dev" target="_blank">ONDEMANDENV Blog</a>-->
                </li>
            </ul>
        </section>

<footer>
            <p>&copy; 2025 ONDEMANDENV.dev</p>
</footer>
    </main>
</div>
</body>
</html> 
