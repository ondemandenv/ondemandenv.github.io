---
layout: default
---

<article>
    {% if page.title %}
    <h1>{{ page.title }}</h1>
    {% endif %}

    {{ content }}
</article>

<!-- Source History Floating Button -->
<a id="source-history-btn" class="source-history-floating-btn" title="View source history on GitHub" href="#" target="_blank" rel="noopener noreferrer">
    <div class="source-btn-icon">üìù</div>
    <div class="source-btn-text">Source History</div>
</a>

<!-- AI Analysis Floating Button -->
<div id="ai-analysis-btn" class="ai-analysis-floating-btn" title="Analyze this article with AI">
    <div class="ai-btn-icon">ü§ñ</div>
    <div class="ai-btn-text">Analyze with AI</div>
    <div class="ai-options-dropdown" id="ai-options-dropdown">
        <button class="ai-option" data-service="perplexity">
            <span class="ai-logo">üîç</span>
            Perplexity
        </button>
        <button class="ai-option" data-service="you">
            <span class="ai-logo">ü§ñ</span>
            You.com
        </button>
        <button class="ai-option" data-service="phind">
            <span class="ai-logo">üíª</span>
            Phind
        </button>
        <hr style="margin: 8px 0; border: none; border-top: 1px solid var(--border-color);">
        <button class="ai-option" data-service="chatgpt">
            <span class="ai-logo">üí¨</span>
            ChatGPT
        </button>
        <button class="ai-option" data-service="gemini">
            <span class="ai-logo">‚ú®</span>
            Gemini
        </button>
    </div>
</div>

<style>
/* Source History Floating Button Styles */
.source-history-floating-btn {
    position: fixed;
    right: 20px;
    bottom: 100px; /* Position above the AI button */
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    border: none;
    border-radius: 50px;
    padding: 12px 20px;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 10px;
    opacity: 0.9;
    user-select: none;
    font-family: inherit;
    font-size: 14px;
    font-weight: 500;
    min-width: 60px;
    overflow: hidden;
    backdrop-filter: blur(10px);
    text-decoration: none;
}

.source-history-floating-btn:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    opacity: 1;
    background: linear-gradient(135deg, #218838, #1e7e34);
    text-decoration: none;
    color: white;
}

.source-history-floating-btn:active {
    transform: translateY(0) scale(0.98);
}

.source-btn-icon {
    font-size: 20px;
    transition: transform 0.3s ease;
    flex-shrink: 0;
}

.source-btn-text {
    white-space: nowrap;
    opacity: 0;
    width: 0;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.source-history-floating-btn:hover .source-btn-text {
    opacity: 1;
    width: auto;
    margin-left: 0;
}

.source-history-floating-btn:hover .source-btn-icon {
    transform: rotate(10deg);
}

/* AI Analysis Floating Button Styles */
.ai-analysis-floating-btn {
    position: fixed;
    right: 20px;
    bottom: 20px;
    background: linear-gradient(135deg, var(--primary-color), #4f46e5);
    color: white;
    border: none;
    border-radius: 50px;
    padding: 12px 20px;
    cursor: pointer;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 10px;
    opacity: 0.9;
    user-select: none;
    font-family: inherit;
    font-size: 14px;
    font-weight: 500;
    min-width: 60px;
    overflow: hidden;
    backdrop-filter: blur(10px);
}

.ai-analysis-floating-btn:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    opacity: 1;
    background: linear-gradient(135deg, #0451a5, #4338ca);
}

.ai-analysis-floating-btn:active {
    transform: translateY(0) scale(0.98);
}

.ai-btn-icon {
    font-size: 20px;
    transition: transform 0.3s ease;
    flex-shrink: 0;
}

.ai-btn-text {
    white-space: nowrap;
    opacity: 0;
    width: 0;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.ai-analysis-floating-btn:hover .ai-btn-text {
    opacity: 1;
    width: auto;
    margin-left: 0;
}

.ai-analysis-floating-btn:hover .ai-btn-icon {
    transform: rotate(10deg);
}

/* AI Options Dropdown */
.ai-options-dropdown {
    position: absolute;
    bottom: calc(100% + 10px);
    right: 0;
    background: white !important;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    opacity: 0;
    visibility: hidden;
    transform: translateY(10px) scale(0.95);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid var(--border-color);
    overflow: visible;
    min-width: 140px;
    z-index: 9999 !important;
    pointer-events: none;

    /* Backup positioning in case bottom doesn't work */
    /* top: -200px; */
}

/* Debug version - always visible for testing */
.ai-options-dropdown.debug-show {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) scale(1) !important;
    pointer-events: auto !important;
    border: 3px solid red !important;
    background: yellow !important;
}

.ai-analysis-floating-btn:hover .ai-options-dropdown {
    opacity: 1 !important;
    visibility: visible !important;
    transform: translateY(0) scale(1) !important;
    z-index: 1001 !important;
    pointer-events: auto !important;
}

.ai-option {
    width: 100%;
    background: none;
    border: none;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    color: var(--text-color);
    font-size: 14px;
    font-weight: 500;
}

.ai-option:hover {
    background-color: #f8f9fa;
}

.ai-option:not(:last-child):not([data-service="phind"]) {
    border-bottom: 1px solid var(--border-color);
}

/* Hide the automatic border for the option before separator */
.ai-option[data-service="phind"] {
    border-bottom: none !important;
}

.ai-logo {
    font-size: 16px;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .source-history-floating-btn {
        right: 15px;
        bottom: 95px;
        padding: 10px 16px;
        font-size: 13px;
    }

    .source-btn-icon {
        font-size: 18px;
    }

    .ai-analysis-floating-btn {
        right: 15px;
        bottom: 15px;
        padding: 10px 16px;
        font-size: 13px;
    }

    .ai-btn-icon {
        font-size: 18px;
    }

    .ai-options-dropdown {
        right: -10px;
        min-width: 120px;
    }

    .ai-option {
        padding: 10px 12px;
        font-size: 13px;
    }
}

/* Animation for entrance */
@keyframes slideInUp {
    from {
        transform: translateY(100px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 0.9;
    }
}

.ai-analysis-floating-btn.show {
    animation: slideInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.source-history-floating-btn.show {
    animation: slideInUp 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    console.log('Page scripts loading...');

    // Source History Button Functionality
    const sourceButton = document.getElementById('source-history-btn');
    if (sourceButton) {
        console.log('Source history button found, setting up...');

        // Show source button after a short delay
        setTimeout(() => {
            sourceButton.classList.add('show');
            console.log('Source history button shown');
        }, 1200);

        // Set up the source history link based on current page
        const currentPath = window.location.pathname;
        console.log('Current path:', currentPath);

        // Extract article name from path (remove /articles/ prefix and any trailing slash)
        let articleName = '';
        if (currentPath.startsWith('/articles/')) {
            articleName = currentPath.replace('/articles/', '').replace(/\/$/, '');
        } else if (currentPath.includes('/articles/')) {
            // Handle cases where there might be a base path
            const articlesIndex = currentPath.indexOf('/articles/');
            articleName = currentPath.substring(articlesIndex + 10).replace(/\/$/, '');
        }

        console.log('Extracted article name:', articleName);

        if (articleName) {
            const sourceHistoryUrl = `https://github.com/ondemandenv/ondemandenv.github.io/commits/main/articles/${articleName}.md`;
            sourceButton.href = sourceHistoryUrl;
            sourceButton.target = '_blank';
            console.log('Source history URL set to:', sourceHistoryUrl);
        } else {
            // Fallback to general articles directory
            sourceButton.href = 'https://github.com/ondemandenv/ondemandenv.github.io/tree/main/articles';
            sourceButton.target = '_blank';
            console.log('Using fallback source history URL');
        }
    }

    // AI Analysis Button Functionality
    console.log('AI Analysis button script loading...');

    const aiButton = document.getElementById('ai-analysis-btn');
    const aiOptions = document.getElementById('ai-options-dropdown');

    if (!aiButton || !aiOptions) {
        console.error('AI button elements not found!');
        return;
    }

    console.log('AI button elements found, initializing...');

    // Show button after a short delay
    setTimeout(() => {
        aiButton.classList.add('show');
        console.log('AI button shown');
    }, 1000);

    // Handle clicks on the main AI button
    aiButton.addEventListener('click', function(e) {
        console.log('Main AI button clicked');

        // Check if click is on dropdown options
        let target = e.target;

        // Find the ai-option element (could be the target or a parent)
        while (target && !target.classList.contains('ai-option')) {
            target = target.parentElement;
            if (!target || target === aiButton) break;
        }

        if (target && target.classList.contains('ai-option')) {
            console.log('AI option clicked:', target.getAttribute('data-service'));
            e.preventDefault();
            e.stopPropagation();
            const service = target.getAttribute('data-service');
            openAIService(service);
        } else {
            // If user clicked the main button (not an option), default to Perplexity
            console.log('Main button clicked - defaulting to Perplexity');
            openAIService('perplexity');
        }
    });

    // Also handle hover state for showing options
    let isHovering = false;
    aiButton.addEventListener('mouseenter', function() {
        isHovering = true;
        console.log('Hovering over AI button - options should be visible');
    });

    aiButton.addEventListener('mouseleave', function() {
        isHovering = false;
        console.log('Left AI button hover area');
    });

    function openAIService(service) {
        console.log('Opening AI service:', service);

        const currentUrl = window.location.href;
        const articleTitle = document.querySelector('h1') ? document.querySelector('h1').textContent.trim() : 'this article';

        console.log('Article URL:', currentUrl);
        console.log('Article Title:', articleTitle);

        // Create the prompt
        const githubBackupUrl = `https://github.com/ondemandenv/ondemandenv.github.io/blob/main${window.location.pathname.replace(/\/$/, '')}.md`;
        const prompt = `As very senior software engineer/architect, think ultra hard and analyze/summarize this article about software engineering and distributed systems in depth,

Article URL: ${currentUrl}
GitHub Backup URL (if above URL is not accessible): ${githubBackupUrl}

Confirm that you can access/download this article from either URL, if not, prompt user to copy/paste the article here, then provide:

1. A concise summary of the main/key points, insights and takeaways.
2. How is this valuable relates to current trends in software engineering.
3. How unique, original and novel is this article's ideas/perspectives/insights/approaches.
4. how is the article quality? what is the author's SDE level?

Ask whether user want non technical explanation with analogy in detail.
`;

        console.log('Generated prompt:', prompt);

        // URL encode the prompt for use in query parameters
        const encodedPrompt = encodeURIComponent(prompt);

        let url;
        switch(service) {
            case 'perplexity':
                // Perplexity supports URL parameters with ?q=
                url = `https://perplexity.ai/?q=${encodedPrompt}`;
                break;
            case 'you':
                // You.com supports URL parameters with ?q=
                url = `https://you.com/search?q=${encodedPrompt}`;
                break;
            case 'phind':
                // Phind supports URL parameters with ?q=
                url = `https://www.phind.com/search?q=${encodedPrompt}`;
                break;
            default:
                console.error('Unknown service:', service);
                return;
        }
        console.log('Opening URL:', url);

        window.open(url, '_blank', 'noopener,noreferrer');

    }



    // Hide buttons when scrolling near bottom (so they don't cover footer)
    let ticking = false;
    function updateButtonVisibility() {
        if (!ticking) {
            requestAnimationFrame(() => {
                const scrolled = window.scrollY;
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                const scrolledPercentage = (scrolled + windowHeight) / documentHeight;

                // Hide buttons when user is in the last 10% of the page
                if (scrolledPercentage > 0.9) {
                    if (aiButton) {
                        aiButton.style.transform = 'translateY(100px)';
                        aiButton.style.opacity = '0';
                    }
                    if (sourceButton) {
                        sourceButton.style.transform = 'translateY(100px)';
                        sourceButton.style.opacity = '0';
                    }
                } else {
                    if (aiButton) {
                        aiButton.style.transform = 'translateY(0)';
                        aiButton.style.opacity = '0.9';
                    }
                    if (sourceButton) {
                        sourceButton.style.transform = 'translateY(0)';
                        sourceButton.style.opacity = '0.9';
                    }
                }

                ticking = false;
            });
        }
        ticking = true;
    }

    window.addEventListener('scroll', updateButtonVisibility);

    console.log('AI Analysis button script fully loaded and ready!');
});
</script> 