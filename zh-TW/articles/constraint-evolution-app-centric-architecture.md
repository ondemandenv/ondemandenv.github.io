---
layout: article
title: "約束的巨大轉變：現代系統中從物理分區到邏輯分區"
permalink: /zh-TW/articles/constraint-evolution-app-centric-architecture/
---

# 約束的巨大轉變：現代系統中從物理分區到邏輯分區

*從實體機到雲端的演進，如何從根本上改變了驅動架構決策的約束，從而實現了真正以應用為中心的基礎設施*

## 基本洞察

在軟體架構、開發實踐和基礎設施管理的演進過程中，一個深刻的模式正在浮現。從實體機到雲端的轉變不僅僅是技術上的轉移——它是一個**根本性的約束倒置**，使得全新的系統設計和組織結構方法成為可能。

這種約束的演進遵循一個可預測的模式：**隨著主導約束的改變，最佳的分區策略也會改變，從而催生新的架構典範**。理解這個模式有助於解釋為什麼像BizDevOps、以應用為中心的基礎設施和領域驅動的分區等現代方法不僅僅是時髦——它們是不可避免的。

## 約束演進的三個時代

### 時代一：物理約束主導（實體機時代）

在實體機時代，物理約束是主要的架構驅動力：

#### 主要約束：
- **硬體稀缺性**：伺服器是昂貴、珍貴的資源，需要最大限度地利用。
- **網路限制**：頻寬成本高昂，延遲由地理位置固定。
- **部署複雜性**：變更需要物理接觸、協調和巨大的風險。
- **運營專業知識**：管理硬體需要專門的知識和全天候的人員。
- **故障模式**：硬體故障是災難性的，需要備援和周密的計畫。

#### 由此產生的分區策略：
物理約束迫使我們採取**技術優先的分區**：
- **開發-運營邊界**：開發人員編寫代碼，運營人員管理基礎設施。
- **共享基礎設施**：多個應用程式共享昂貴的硬體。
- **批次處理**：對於大多數使用案例來說，即時處理成本太高。
- **垂直擴展**：增加容量意味著購買更大、更昂貴的機器。
- **集中式服務**：共享資料庫、應用程式伺服器和網路服務。

這種分區方式完全合理——**最昂貴和風險最高的約束是物理基礎設施管理**，因此它值得擁有專門的專業知識和謹慎的隔離。

### 時代二：平台抽象化（早期雲端時代）

早期的雲端時代開始通過平台服務來抽象化物理約束：

#### 過渡時期的約束：
- **基礎設施即代碼**：物理配置變成了API呼叫。
- **託管服務**：資料庫管理、負載平衡和訊息傳遞成為平台的職責。
- **彈性擴展**：水平擴展在經濟上變得可行。
- **部署自動化**：CI/CD管道降低了部署風險和複雜性。
- **監控與可觀察性**：平台提供對系統行為的洞察。

#### 混合分區策略：
早期的雲端採用創造了**混合的分區**方法：
- **基礎設施即代碼**：運營團隊通過代碼管理基礎設施。
- **平台服務**：一些運營問題被委託給託管服務。
- **微服務**：服務可以獨立部署和擴展。
- **DevOps團隊**：一些組織合併了開發和運營團隊。
- **事件驅動架構**：非同步處理變得容易實現。

這個時代揭示了舊的分區策略（為物理約束優化）與新能力（由平台抽象化實現）之間的張力。

### 時代三：邏輯約束主導（現代雲端）

現代雲端平台在很大程度上消除了物理約束，使得**業務邏輯和領域邊界**成為主要的架構驅動力：

#### 新的主要約束：
- **業務敏捷性**：功能交付速度和市場反應能力。
- **領域複雜性**：管理業務邏輯和領域關係。
- **團隊自主性**：獨立的開發和部署能力。
- **用戶體驗**：即時響應和全球可用性。
- **合規性與安全性**：特定領域的法規和安全要求。

#### 邏輯優先的分區策略：
隨著物理約束的抽象化，**業務領域優先的分區**成為最佳選擇：
- **BizDevOps**：團隊擁有包括基礎設施在內的整個業務領域。
- **以應用為中心的基礎設施**：基礎設施跟隨應用程式的邊界。
- **領域驅動服務**：服務邊界與業務的有界上下文對齊。
- **事件驅動架構**：業務事件驅動系統協調。
- **自主團隊**：每個團隊擁有其完整的垂直切片。

## K-D樹模式：分區順序決定複雜性

從物理約束到邏輯約束的演進，反映了[K-D樹的分區原則](/articles/kd-tree-software-partition-sequence/)：**分區決策的順序對系統複雜性有指數級的影響**。

### 錯誤的分區順序（物理優先）：
1. **按技術關注點分區**：分離開發、運營、品保、基礎設施團隊。
2. **按技術分區**：資料庫團隊、前端團隊、後端團隊。
3. **按部署分區**：共享環境、協調發布。
4. **結果**：隨著規模擴大，協調的複雜性呈指數級增長。

### 正確的分區順序（邏輯優先）：
1. **按業務領域分區**：客戶服務、支付處理、庫存管理。
2. **按團隊所有權分區**：每個團隊擁有其完整的垂直切片。
3. **按部署邊界分區**：每個領域獨立部署。
4. **結果**：隨著系統的增長，協調工作保持在最低限度。

這解釋了為什麼採用技術優先分區的傳統企業架構會變得越來越複雜，而採用領域優先分區的現代雲原生架構在規模擴大時仍能保持可管理性。

## 架構演進模式

[架構演進的各個階段](/articles/from-rds-to-distributed-phases-evolution-enhanced/)遵循這種由約束驅動的模式：

### 階段一（實體機時代）：以單體式RDS為中心
- **約束**：物理硬體限制。
- **解決方案**：最大化利用昂貴的基礎設施。
- **分區**：技術性——單一資料庫、單一應用程式、單一團隊。

### 階段二（早期雲端時代）：基於佇列的處理
- **約束**：用戶體驗與處理時間的權衡。
- **解決方案**：將用戶請求與處理分離。
- **分區**：流程——同步與非同步操作。

### 階段三（平台時代）：步驟級佇列
- **約束**：可靠性和故障隔離。
- **解決方案**：在步驟級別隔離故障。
- **分區**：工作流程——每個步驟都變得可獨立管理。

### 階段四（現代雲端）：事件驅動的微服務
- **約束**：業務敏捷性和團隊自主性。
- **解決方案**：領域驅動的服務邊界。
- **分區**：業務——每個服務擁有一個完整的業務能力。

每個階段都代表著不同的約束-分區平衡狀態，後面的階段只有在平台服務抽象化了早期的約束後才變得可行。

## 開發-運營邊界：約束的產物

[開發與運營邊界的模糊化](/articles/blurring-lines-dev-ops-modern-cloud/)完美地說明了這種約束的演進：

### 歷史上的理由：
在以下情況下，開發-運營的邊界是合理的：
- **物理基礎設施**是主要約束。
- 管理硬體需要**專業知識**。
- **變更具有風險**並需要謹慎協調。
- **運營專業知識**與開發技能截然不同。

### 現代的現實：
雲端平台消除了這些理由：
- **基礎設施**是通過API和代碼來配置的。
- **運營問題**越來越多地是應用程式特定的。
- **變更是常規的**並且可以安全地自動化。
- **領域專業知識**比基礎設施專業知識更重要。

這就是為什麼現在的開發人員會配置DynamoDB流處理、實施事件溯源模式，並通過應用程式代碼管理基礎設施——最初為開發-運營分離提供正當性的約束已不復存在。

## 以應用為中心的架構：邏輯的終點

隨著物理約束的抽象化，最佳的分區策略變成了**以應用為中心**：每個應用程式擁有其完整的垂直切片，包括基礎設施、數據、處理和運營問題。

### 關鍵原則：
1. **業務領域邊界**：應用程式是有界上下文，而非技術產物。
2. **自主團隊**：每個團隊擁有其完整的垂直切片。
3. **基礎設施即代碼**：應用程式團隊通過代碼管理其基礎設施。
4. **平台服務**：利用託管服務來處理無差異的繁重工作。
5. **事件驅動的協調**：業務事件在應用程式之間進行協調。

### ONDEMANDENV的理念：
這種約束的演進正是[ONDEMANDENV](https://ondemandenv.dev)專注於以應用為中心的基礎設施的原因：
- **應用程式作為一等公民**：圍繞業務應用程式組織基礎設施。
- **邏輯分區**：邊界遵循業務領域，而非技術上的便利。
- **團隊自主性**：每個團隊擁有其完整的部署和執行環境。
- **平台抽象化**：複雜的基礎設施問題由平台服務處理。

## 普遍模式：由約束驅動的分區

這個模式普遍適用於整個軟體架構：

### 數據系統：
- **錯誤**：按技術結構分區（正規化表格、技術鍵）。
- **正確**：按業務訪問模式分區（客戶領域、地區邊界）。

### 團隊組織：
- **錯誤**：按技術專長分區（前端、後端、資料庫、運營）。
- **正確**：按業務領域分區（客戶服務、支付、庫存）。

### 部署策略：
- **錯誤**：按技術層次分區（資料庫變更、服務變更、UI變更）。
- **正確**：按業務功能分區（獨立部署的完整垂直切片）。

### 基礎設施管理：
- **錯誤**：按技術關注點分區（計算、存儲、網路、安全）。
- **正確**：按業務應用程式分區（每個應用程式擁有其完整的基礎設施）。

## 普遍的顛覆模式

這種約束演進的模式遠不止於軟體架構——它是一個**普遍的顛覆機制**，解釋了整個行業如何轉型：

### 歷史案例：
- **Uber vs. 計程車**：交通運輸的約束從物理調度轉向數位協調。
- **亞馬遜 vs. K-mart**：商業的約束從實體庫存轉向數位履行。
- **AI vs. 網路搜索**：資訊的約束從基於查詢轉向情境感知的智能。

每個案例都代表著一個**根本性的約束倒置**，舊的優化策略變成了新的限制。

## 碎片化陷阱：為何阻力是結構性的

對約束演進的阻力不僅僅是心理上的——它是**結構性的**。組織陷入了**局部最優解**的陷阱，而這些解實際上比舊方法和新方法都更糟糕。

### 複雜度的峽谷
現代組織常常卡在兩個高峰之間的**複雜度峽谷**中：
- **高峰一**：為舊約束優化的簡單系統（為物理限制優化的單體應用）。
- **峽谷**：未經優化的碎片化系統（YAML泛濫、微服務混亂）。
- **高峰二**：為新約束優化的優雅系統（以應用為中心的架構）。

這個陷阱的發生原因如下：
1. **淺層任務成為通行證**：YAML操作和容器編排感覺像是進步。
2. **部落知識成為權力**：系統的複雜性創造了專業知識的人為稀缺性。
3. **英雄文化出現**：救火比預防更受重視。
4. **創新停止**：害怕破壞脆弱系統阻礙了有意義的變革。

組織之所以抗拒向高峰二邁進，是因為他們已經從攀登高峰一中筋疲力盡，卻沒有意識到他們所處的峽谷實際上比任何一個目的地都更難以駕馭。

### 認知問題

最困難的挑戰是**人們沒有意識到他們正在為舊的約束進行優化**。這發生的原因如下：

1. **約束的演進是無形的**：從物理約束到邏輯約束的轉變是漸進的，很難察覺。
2. **中間的複雜度感覺像是進步**：與手動伺服器管理相比，YAML編排和容器管理感覺更為複雜和先進。
3. **沉沒成本謬誤**：組織已在DevOps工具和GitOps實踐上投入巨資。
4. **成功指標滯後**：團隊衡量的是部署頻率和容器正常運行時間，而不是業務交付速度。
5. **專業知識成為身份認同**：技術專家抗拒承認他們的專業知識可能正在為錯誤的約束進行優化。

這就產生了一個**約束認知差距**，即使真正的約束已經轉移到邏輯稀缺性（業務敏捷性、領域理解），組織仍然繼續為物理稀缺性（基礎設施效率、部署協調）進行優化。

## 下一階段：由AI定義的約束

如果AI定義了下一個約束階段，我們很可能正從**邏輯約束**轉向**智能增強的約束**：

- **當前時代**：為業務領域邊界和團隊自主性進行優化。
- **下一時代**：為AI與人類協作和自主決策進行優化。

這可能意味著系統將**圍繞意圖而非結構進行自我組織**，AI代理將根據業務成果而非技術規格來管理基礎設施。

## 不可避免的未來

從物理約束到邏輯約束的演進是不可逆轉的，而向智能增強約束的下一階段似乎正在加速。隨著平台服務繼續抽象化無差異的基礎設施問題，最佳的分區策略將越來越青睞業務領域而非技術邊界。

### 這意味著：
- **傳統的IT角色**將繼續向業務領域專業知識演進。
- **基礎設施團隊**將專注於平台服務，而不是管理單個資源。
- **開發團隊**將擁有越來越完整的垂直切片。
- **架構模式**將為業務敏捷性而非技術效率進行優化。

### 競爭優勢：潛在的巨大影響

雖然全貌仍在浮現，但歷史模式表明，競爭優勢可能是**巨大的**：

**歷史證據**：
- **Uber**並非逐步改進計程車——它使其過時。
- **亞馬遜**不僅僅是與K-mart競爭——它使實體零售變得次要。
- **AI**不僅僅是在改進搜索——它正在使基於查詢的資訊檢索顯得原始。 