---
layout: null
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Diagram Viewer</title>
    <meta name="description" content="Standalone Mermaid diagram viewer with fullscreen and pan/zoom controls">
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HLWV6BZQE1"></script>
    <script>
        // Simple viewport sizer to guarantee full-page container on load/resize/fullscreen
        function __sizeViewport() {
          const v = document.getElementById('viewer');
          const s = document.getElementById('stage');
          const w = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
          const h = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
          if (v) { v.style.width = w + 'px'; v.style.height = h + 'px'; }
          if (s) { s.style.width = '100%'; s.style.height = '100%'; }
        }
        document.addEventListener('DOMContentLoaded', __sizeViewport);
        window.addEventListener('load', __sizeViewport);
        window.addEventListener('resize', __sizeViewport);
        document.addEventListener('fullscreenchange', __sizeViewport);
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-HLWV6BZQE1');
    </script>
    
    <!-- Standalone libraries: do not depend on site CSS/JS -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.9.0/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    
    <style>
      html, body { height: 100%; margin: 0; background: #111; width: 100%; overflow: hidden; }
      :root { --ui: rgba(0,0,0,0.65); --ui-border: #333; --accent: #3b82f6; --text: #eee; }
      .viewer { position: fixed; inset: 0; width: 100vw; height: 100dvh; background: #fff; }
      .toolbar, .right-controls { position: fixed; top: 12px; display: flex; gap: 8px; z-index: 1000; }
      .toolbar { left: 12px; }
      .right-controls { right: 12px; }
      .btn { background: var(--ui); color: var(--text); border: 1px solid var(--ui-border); padding: 8px 12px; border-radius: 8px; cursor: pointer; font: 500 13px system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
      .btn:hover { background: #000; color: #fff; border-color: #222; }
      #stage { position: absolute; inset: 0; width: 100%; height: 100%; overflow: hidden; background: #fff; }
      #diagram { width: 100%; height: 100%; }
      #diagram svg { width: 100% !important; height: 100% !important; max-width: none !important; max-height: none !important; display: block; }
      .info { position: fixed; bottom: 12px; left: 12px; background: var(--ui); color: #fff; border: 1px solid var(--ui-border); padding: 8px 12px; border-radius: 8px; font: 12px system-ui; z-index: 1000; }
      .overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,.6); color: #fff; z-index: 1500; font: 16px system-ui; }
      .overlay.show { display: flex; }
    </style>
</head>
<body>
    <div class="viewer" id="viewer">
      <div class="toolbar">
        <button class="btn" id="btnBack">← Back</button>
        <button class="btn" id="btnFit">Fit</button>
        <button class="btn" id="btnCenter">Center</button>
        <button class="btn" id="btnActual">1:1</button>
      </div>
      <div class="right-controls">
        <button class="btn" id="btnZoomIn">＋</button>
        <button class="btn" id="btnZoomOut">－</button>
        <button class="btn" id="btnReset">Reset</button>
        <button class="btn" id="btnFullscreen">⛶</button>
        <button class="btn" id="btnDownload">⬇︎ SVG</button>
      </div>
      <div id="stage"><div id="diagram"></div></div>
      <div class="info" id="diagram-info">Loading...</div>
      <div class="overlay" id="fsOverlay"><div>Click to enter fullscreen</div></div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            themeVariables: {
                primaryColor: '#0366d6',
                primaryTextColor: '#24292e',
                primaryBorderColor: '#e1e4e8',
                lineColor: '#6a737d',
                backgroundColor: '#ffffff'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            },
            sequence: {
                useMaxWidth: true
            },
            gantt: {
                useMaxWidth: true
            }
        });

        class MermaidViewer {
            constructor() {
                this.panZoom = null;
                this.currentMmdFile = null;
                this.init();
            }

            init() {
                // Replace shared-page UI with standalone viewer controls
                this.bootstrapStandaloneUI();
                this.setupStandaloneEvents();
                this.loadStandaloneParams();
            }

            bootstrapStandaloneUI() {
                // Build a minimal standalone UI layout
                const body = document.body;
                body.innerHTML = `
                  <div class="viewer" id="viewer">
                    <div class="toolbar">
                      <button class="btn" id="btnBack">← Back</button>
                      <button class="btn" id="btnFit">Fit</button>
                      <button class="btn" id="btnCenter">Center</button>
                      <button class="btn" id="btnActual">1:1</button>
                    </div>
                    <div class="right-controls">
                      <button class="btn" id="btnZoomIn">＋</button>
                      <button class="btn" id="btnZoomOut">－</button>
                      <button class="btn" id="btnReset">Reset</button>
                      <button class="btn" id="btnFullscreen">⛶</button>
                      <button class="btn" id="btnDownload">⬇︎ SVG</button>
                    </div>
                    <div id="stage"><div id="diagram"></div></div>
                    <div class="info" id="diagram-info">Loading...</div>
                    <div class="overlay" id="fsOverlay"><div>Click to enter fullscreen</div></div>
                  </div>`;
            }

            setupStandaloneEvents() {
                this.viewer = document.getElementById('viewer');
                this.container = document.getElementById('diagram');
                this.info = document.getElementById('diagram-info');
                this.overlay = document.getElementById('fsOverlay');
                const params = new URLSearchParams(location.search);
                this.backHref = params.get('back') || 'articles.html';
                this.autoFS = params.get('autofullscreen') === '1' || !params.has('autofullscreen');

                // Ensure viewport is maximized on load
                this.ensureFullViewport?.();

                document.getElementById('btnBack').onclick = ()=> { window.location.href = this.backHref; };
                document.getElementById('btnFit').onclick = ()=> { if (this.panZoom){ this.ensureFullViewport?.(); this.panZoom.resize(); this.panZoom.fit(); this.panZoom.center(); this.updateInfo(); } };
                document.getElementById('btnCenter').onclick = ()=> { if (this.panZoom){ this.panZoom.center(); this.updateInfo(); } };
                document.getElementById('btnActual').onclick = ()=> { if (this.panZoom){ this.panZoom.zoom(1.0); this.panZoom.center(); this.updateInfo(); } };
                document.getElementById('btnZoomIn').onclick = ()=> { if (this.panZoom){ this.panZoom.zoomIn(); this.updateInfo(); } };
                document.getElementById('btnZoomOut').onclick = ()=> { if (this.panZoom){ this.panZoom.zoomOut(); this.updateInfo(); } };
                document.getElementById('btnReset').onclick = ()=> { if (this.panZoom){ this.panZoom.resetZoom(); this.panZoom.resetPan(); this.updateInfo(); } };
                document.getElementById('btnFullscreen').onclick = async ()=> {
                  if (!document.fullscreenElement) { try { await this.viewer.requestFullscreen(); } catch {} } else { try { await document.exitFullscreen(); } catch {} }
                  if (this.panZoom){ this.ensureFullViewport?.(); this.panZoom.resize(); this.panZoom.fit(); this.panZoom.center(); this.updateInfo(); }
                };
                document.getElementById('btnDownload').onclick = ()=> { const svgEl = this.container.querySelector('svg'); if (!svgEl) return; const blob = new Blob([svgEl.outerHTML], {type:'image/svg+xml;charset=utf-8'}); const url = URL.createObjectURL(blob); const a = document.createElement('a'); const safe = (this.currentMmdFile||'diagram.mmd').split('/').pop().replace(/\.mmd$/,'') + '.svg'; a.href = url; a.download = safe; a.click(); setTimeout(()=>URL.revokeObjectURL(url), 2000); };

                this.overlay.addEventListener('click', async ()=>{ this.overlay.classList.remove('show'); try { await this.viewer.requestFullscreen(); if (this.panZoom){ this.ensureFullViewport?.(); this.panZoom.resize(); this.panZoom.fit(); this.panZoom.center(); } } catch {} });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e)=>{
                  if (e.target && ['INPUT','TEXTAREA'].includes(e.target.tagName)) return;
                  switch(e.key){ case '+': case '=': e.preventDefault(); if (this.panZoom) this.panZoom.zoomIn(); break; case '-': case '_': e.preventDefault(); if (this.panZoom) this.panZoom.zoomOut(); break; case '0': e.preventDefault(); if (this.panZoom){ this.panZoom.resetZoom(); this.panZoom.center(); } break; case 'f': e.preventDefault(); document.getElementById('btnFullscreen').click(); break; }
                  this.updateInfo();
                });

                window.addEventListener('resize', ()=> { this.ensureFullViewport?.(); if (this.panZoom){ this.panZoom.resize(); this.panZoom.fit(); this.panZoom.center(); } });
            }

            loadStandaloneParams() {
                const params = new URLSearchParams(location.search);
                const theme = params.get('theme') || 'default';
                mermaid.initialize({ startOnLoad:false, theme, flowchart:{useMaxWidth:true, htmlLabels:true}, sequence:{useMaxWidth:true}, gantt:{useMaxWidth:true} });
                this.loadDiagramFromUrl();
            }

            setupEventListeners() {
                // Control buttons
                document.getElementById('zoom-in').addEventListener('click', () => this.zoomIn());
                document.getElementById('zoom-out').addEventListener('click', () => this.zoomOut());
                document.getElementById('zoom-reset').addEventListener('click', () => this.resetZoom());
                document.getElementById('center').addEventListener('click', () => this.centerDiagram());
                document.getElementById('fullscreen').addEventListener('click', () => this.toggleFullscreen());

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.target.tagName.toLowerCase() === 'input') return;
                    
                    switch(e.key) {
                        case '=':
                        case '+':
                            e.preventDefault();
                            this.zoomIn();
                            break;
                        case '-':
                            e.preventDefault();
                            this.zoomOut();
                            break;
                        case '0':
                            e.preventDefault();
                            this.resetZoom();
                            break;
                        case 'c':
                            e.preventDefault();
                            this.centerDiagram();
                            break;
                        case 'f':
                            e.preventDefault();
                            this.toggleFullscreen();
                            break;
                        case 'Escape':
                            if (document.fullscreenElement) {
                                document.exitFullscreen();
                            }
                            break;
                    }
                });

                // Window resize
                window.addEventListener('resize', () => {
                    if (this.panZoom) {
                        this.panZoom.resize();
                    }
                });
            }

            async loadDiagramFromUrl() {
                const urlParams = new URLSearchParams(window.location.search);
                const mmdFile = urlParams.get('mmd');

                if (!mmdFile) {
                    this.showError('No diagram file specified', 'Add ?mmd=path/to/file.mmd to the URL');
                    return;
                }

                this.currentMmdFile = mmdFile;
                document.title = `${mmdFile} - Mermaid Diagram Viewer`;

                try {
                    await this.loadMermaidFile(mmdFile);
                } catch (error) {
                    this.showError('Failed to load diagram', error.message);
                }
            }

            async loadMermaidFile(filePath) {
                try {
                    const response = await fetch(filePath);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }

                    const mmdContent = await response.text();
                    await this.renderMermaid(mmdContent);
                } catch (error) {
                    throw new Error(`Cannot load ${filePath}: ${error.message}`);
                }
            }

            async renderMermaid(mmdContent) {
                const container = this.container;
                
                try {
                    // Clear existing content
                    container.innerHTML = '';

                    // Create a unique ID for this diagram
                    const diagramId = 'mermaid-diagram-' + Date.now();

                    // Render the mermaid diagram
                    const { svg } = await mermaid.render(diagramId, mmdContent);
                    
                    // Create diagram container
                    container.innerHTML = `${svg}`;
                    // Force SVG to fill container and remove inline caps added by Mermaid
                    const svgEl = container.querySelector('svg');
                    if (svgEl) {
                        try {
                            // Remove Mermaid inline caps like max-width that constrain fullscreen
                            svgEl.removeAttribute('style');
                            svgEl.style.maxWidth = 'none';
                            svgEl.style.maxHeight = 'none';
                            svgEl.style.width = '100%';
                            svgEl.style.height = '100%';
                            svgEl.style.overflow = 'visible';
                            svgEl.removeAttribute('width');
                            svgEl.removeAttribute('height');
                            svgEl.setAttribute('preserveAspectRatio', 'xMidYMid meet');
                        } catch {}
                    }

                    // Initialize pan and zoom
                    this.initializePanZoom();

                    // Update info
                    this.updateDiagramInfo();

                } catch (error) {
                    this.showError('Failed to render diagram', error.message);
                }
            }

            initializePanZoom() {
                const svgElement = this.container.querySelector('svg');
                if (!svgElement) return;

                // Destroy existing pan-zoom instance
                if (this.panZoom) {
                    this.panZoom.destroy();
                }

                // Initialize new pan-zoom
                this.panZoom = svgPanZoom(svgElement, {
                    zoomEnabled: true,
                    controlIconsEnabled: false,
                    fit: true,
                    center: true,
                    minZoom: 0.1,
                    maxZoom: 20,
                    zoomScaleSensitivity: 0.3,
                    dblClickZoomEnabled: true,
                    mouseWheelZoomEnabled: true,
                    preventMouseEventsDefault: true,
                    eventsListenerElement: svgElement.parentElement
                });

                // Enable controls
                // Controls are always enabled in standalone viewer

                // Initial fit/center after sizing
                try {
                    this.panZoom.resize();
                    // Fit strategy: choose the smaller scale between width/height to maximize viewport usage
                    this.panZoom.fit();
                    this.panZoom.center();
                    // Nudge to ensure full viewport after browser chrome settles
                    setTimeout(()=>{ try { this.panZoom.resize(); this.panZoom.fit(); this.panZoom.center(); } catch{} }, 50);
                } catch {}
            }

            enableControls() {
                const controls = [];
                controls.forEach(btn => btn.disabled = false);
            }

            disableControls() {
                const controls = document.querySelectorAll('.control-btn');
                controls.forEach(btn => btn.disabled = true);
            }

            zoomIn() {
                if (this.panZoom) {
                    this.panZoom.zoomIn();
                    this.updateDiagramInfo();
                }
            }

            zoomOut() {
                if (this.panZoom) {
                    this.panZoom.zoomOut();
                    this.updateDiagramInfo();
                }
            }

            resetZoom() {
                if (this.panZoom) {
                    this.panZoom.resetZoom();
                    this.updateDiagramInfo();
                }
            }

            centerDiagram() {
                if (this.panZoom) {
                    this.panZoom.center();
                    this.panZoom.fit();
                    this.updateDiagramInfo();
                }
            }

            toggleFullscreen() {
                const viewer = this.viewer || document.getElementById('viewer');
                
                if (!document.fullscreenElement) {
                    viewer.requestFullscreen().then(() => {
                        __sizeViewport();
                        if (this.panZoom) { this.panZoom.resize(); this.panZoom.fit(); this.panZoom.center(); }
                    });
                } else {
                    document.exitFullscreen().then(() => {
                        __sizeViewport();
                        if (this.panZoom) { this.panZoom.resize(); this.panZoom.fit(); this.panZoom.center(); }
                    });
                }
            }

            updateDiagramInfo() {
                if (!this.panZoom) return;

                const zoom = Math.round(this.panZoom.getZoom() * 100);
                const info = document.getElementById('diagram-info');
                info.textContent = `Zoom: ${zoom}% • Use mouse wheel or controls to zoom • Drag to pan`;
            }

            showError(title, detail) {
                const container = document.getElementById('diagram-content');
                container.innerHTML = `
                    <div class="error">
                        <h3>⚠️ ${title}</h3>
                        <p>Please check the file path and try again.</p>
                        ${detail ? `<div class="error-detail">${detail}</div>` : ''}
                    </div>
                `;
                this.disableControls();
            }
        }

        // Initialize the viewer when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new MermaidViewer();
        });
    </script>
</body>
</html>